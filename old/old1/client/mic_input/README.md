# π§ Client Audio Streaming System Documentation

## β… κ°μ”
μ΄ λ¬Έμ„λ” ν΄λΌμ΄μ–ΈνΈ μΈ΅μ—μ„ λ§μ΄ν¬ μ…λ ¥μ„ ν†µν•΄ μ‹¤μ‹κ°„ μ¤λ””μ¤ μ¤νΈλ¦¬λ°μ„ μ²λ¦¬ν•κ³ , Whisper κΈ°λ°μ STT μ„λ²„μ™€ WebSocketμ„ ν†µν•΄ μƒνΈμ‘μ©ν•λ” μ „μ²΄ λ™μ‘ νλ¦„κ³Ό κ° λ¨λ“μ— λ€ν• μ„¤λ…μ„ μ •λ¦¬ν•©λ‹λ‹¤.

---

## π“¦ λ””λ ‰ν† λ¦¬ κµ¬μ΅°

```
client/
β””β”€β”€ audio_streaming_input/
    β”β”€β”€ main.py                 # μ‹¤ν–‰ μ§„μ…μ 
    β”β”€β”€ mic_capture.py          # λ§μ΄ν¬ μ…λ ¥ μ²λ¦¬
    β”β”€β”€ audio_buffer.py         # μ¬λΌμ΄λ”© λ²„νΌ (2μ΄ + 1μ΄ μ¤λ²„λ©)
    β”β”€β”€ tiny_detector_ws.py     # λ°ν™” κ°μ§€μ© WebSocket ν΄λΌμ΄μ–ΈνΈ
    β””β”€β”€ stt_dispatcher_ws.py    # STT μ²λ¦¬μ© WebSocket ν΄λΌμ΄μ–ΈνΈ
```

---

## π” μ „μ²΄ λ™μ‘ νλ¦„

1. `main.py`μ—μ„ `MicCapture` ν΄λμ¤λ¥Ό ν†µν•΄ λ§μ΄ν¬ μ…λ ¥ μ¤νΈλ¦Ό μ‹μ‘
2. λ§¤ ν”„λ μ„(30ms) λ‹¨μ„λ΅ μ¤λ””μ¤ λ°μ΄ν„°λ¥Ό λ°›μ•„ `SlidingAudioBuffer`μ— μ¶”κ°€
3. μ¬λΌμ΄λ”© λ²„νΌκ°€ 2μ΄ μ΄μƒ κµ¬μ„±λλ©΄ μ²­ν¬ μ¶”μ¶
4. `TinySpeechDetector`λ¥Ό ν†µν•΄ ν•΄λ‹Ή μ²­ν¬μ— λ°ν™”κ°€ μλ”μ§€ WebSocketμΌλ΅ κ°μ§€ μ”μ²­
5. λ°ν™”κ°€ κ°μ§€λλ©΄, `STTDispatcher`λ¥Ό ν†µν•΄ μ²­ν¬ λ°μ΄ν„°λ¥Ό Whisper STT μ„λ²„μ— μ „μ†΅
6. λ³€ν™λ ν…μ¤νΈλ¥Ό μ½μ†”μ— μ¶λ ¥

---

## π”§ λ¨λ“λ³„ μ„¤λ…

### `mic_capture.py`
- `MicCapture` ν΄λμ¤λ” PyAudioμ™€ WebRTC VADλ¥Ό μ‚¬μ©ν•μ—¬ λ§μ΄ν¬ μ…λ ¥μ„ μ§€μ†μ μΌλ΅ μμ‹ ν•©λ‹λ‹¤.
- κ°μ§€λ μμ„± ν”„λ μ„μ„ λ‚΄λ¶€ λ²„νΌμ— μ €μ¥ν•λ©°, λ¬΄μ μƒνƒκ°€ 0.6μ΄ μ΄μƒ μ§€μ†λλ©΄ λ²„νΌλ¥Ό `audio_q`μ— μ „λ‹¬ν•©λ‹λ‹¤.

### `audio_buffer.py`
- `SlidingAudioBuffer` ν΄λμ¤λ” 2μ΄ λ¶„λ‰μ μ¤λ””μ¤λ¥Ό μμ§‘ν•λ©°, 1μ΄μ”© μ¤λ²„λ©λλ„λ΅ κµ¬μ„±ν•©λ‹λ‹¤.
- μ²­ν¬ κµ¬μ„± μ™„λ£ μ‹, `.get_buffer()`λ΅ ν„μ¬ λ²„νΌλ¥Ό λ°ν™ν•κ³  μ¤λ²„λ© κµ¬κ°„μ„ μ μ§€ν•λ©° μ•λ¶€λ¶„μ„ μ‚­μ ν•©λ‹λ‹¤.

### `tiny_detector_ws.py`
- `TinySpeechDetector` ν΄λμ¤λ” WebSocketμΌλ΅ μ—°κ²°ν•μ—¬ μ¤λ””μ¤ μ²­ν¬λ¥Ό μ„λ²„μ— μ „μ†΅ν•κ³ , ν…μ¤νΈ μ λ¬΄λ΅ λ°ν™”λ¥Ό κ°μ§€ν•©λ‹λ‹¤.
- Whisper Tiny λ¨λΈμ„ μ‚¬μ©ν•λ” μ„λ²„μ—μ„ `/ws/detect` WebSocket μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ κ°μ§€ μ”μ²­μ„ μ²λ¦¬ν•©λ‹λ‹¤.

### `stt_dispatcher_ws.py`
- `STTDispatcher` ν΄λμ¤λ” λ°ν™”κ°€ κ°μ§€λ μ¤λ””μ¤ μ²­ν¬λ¥Ό Whisper Base λ¨λΈμ΄ λ΅λ“λ STT μ„λ²„μ— μ „μ†΅ν•©λ‹λ‹¤.
- `/ws/transcribe` WebSocket μ—”λ“ν¬μΈνΈλ¥Ό ν†µν•΄ μμ„± ν…μ¤νΈ λ³€ν™μ„ μ”μ²­ν•©λ‹λ‹¤.

### `main.py`
- λ¨λ“  λ¨λ“μ„ μ—°κ²°ν•μ—¬ λ™μ‘μ‹ν‚¤λ” μ§„μ…μ μ…λ‹λ‹¤.
- `asyncio` κΈ°λ°μ μ΄λ²¤νΈ λ£¨ν”„μ—μ„ λ§μ΄ν¬ β†’ λ²„νΌλ§ β†’ κ°μ§€ β†’ μ „μ†΅ κ³Όμ •μ„ λΉ„λ™κΈ°λ΅ μ²λ¦¬ν•©λ‹λ‹¤.

---

## β™οΈ μ£Όμ” νλΌλ―Έν„°

| νλΌλ―Έν„° | μ„¤λ… | κΈ°λ³Έκ°’ |
|----------|------|--------|
| `BUFFER_DURATION` | μ¬λΌμ΄λ”© λ²„νΌ κΈΈμ΄ (μ΄) | `2.0` |
| `OVERLAP_DURATION` | λ²„νΌ μ¤λ²„λ© κΈΈμ΄ (μ΄) | `1.0` |
| `CHUNK_DURATION_MS` | ν”„λ μ„ κΈΈμ΄ (ms) | `30` |
| `RATE` | μƒν”λ§ λ μ΄νΈ | `16000 Hz` |
| `CHANNELS` | μ±„λ„ μ | `1 (Mono)` |

---

## π“ κΈ°λ€ ν¨κ³Ό
- λ¬΄μλ―Έν• λ¬΄μ κµ¬κ°„ μ „μ†΅ λ°©μ§€ β†’ μ„±λ¥ ν–¥μƒ
- μ²­ν¬ κΈ°λ° λΉ„λ™κΈ° μ²λ¦¬λ΅ μμ—°μ¤λ¬μ΄ μ¤νΈλ¦¬λ° ν¨κ³Ό
- Whisper Tiny β†’ Whisper Base μ—°κ³„λ΅ μ •ν™•λ„μ™€ μ†λ„ κ· ν• μ μ§€

---

> λ³Έ μ‹μ¤ν…μ€ WebSocket κΈ°λ° μ‹¤μ‹κ°„ STT μ‹μ¤ν…μ ν•µμ‹¬ κµ¬μ΅°λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—μ„ κµ¬ν„ν• κ²ƒμΌλ΅, μ¶”ν›„ TTS/LLM/μ• λ‹λ©”μ΄μ… λ™κΈ°ν™”μ— ν™μ©λ  μ μμµλ‹λ‹¤.

